import time
import numpy as np
from PIL import Image, ImageGrab
from matplotlib import pyplot as plt
import cv2
import pickle
import pyautogui
import pydirectinput
import keyboard
import re
import cv2
import threading

# C D E F G A B C
NotePositions = {
    "G":[974,482] #G major
    ,"A":[1029,456] #A minor
    ,"B":[1073,371] #B minor
    ,"C":[1165,331] #C major
    ,"D":[1231,304] #D major
    ,"E":[1308,244] #E minor
}

SongToPlay = "Rainday"

AllSongs = {
    "Starset":{ #bad and old
        "Tempo":80
        ,"NotesArray":[
            #{"Note":"C","T":1/2}, {"Note":"C","T":1/2}, {"Note":"C","T":1/2}, {"Note":"C","T":1/4}, {"Note":"C","T":1/2}, {"Note":"C","T":1/2}
            {"Note":"D","T":1/4}, {"Note":"D","T":1/2}, {"Note":"D","T":1/2}, {"Note":"D","T":1/4}, {"Note":"D","T":1/2}, {"Note":"D","T":1/2}
            ,{"Note":"E","T":1/4}, {"Note":"E","T":1/2}, {"Note":"E","T":1/2}, {"Note":"E","T":1/4}
            ,{"Note":"G","T":1/4}, {"Note":"A","T":1/4}, {"Note":"B","T":1/4}, {"Note":"C","T":1/8}
           ,{"Note":"B","T":1/4} ,{"Note":"A","T":1/2}, {"Note":"G","T":1/8}, {"Note":"A","T":1/8}, {"Note":"B","T":1/8}, {"Note":"C","T":1/16}
            #{"Note":"E","T":1/2}, {"Note":"C","T":1/2}
           # ,{"Note":"C","T":1}, {"Note":"A","T":1/4}
            #,{"Note":"G","T":1/2}, {"Note":"E","T":1/2}, {"Note":"D","T":1/3}, {"Note":"G","T":1.5}, {"Note":"E","T":1/2}, {"Note":"B","T":1/3}
        ]
    }
    ,"Rainday":{
        "Tempo":89
        ,"NotesArray":[
            {"Note":"A","T":1}, {"Note":"A","T":1}, {"Note":"B","T":1/2}, {"Note":"B","T":1/2}, {"Note":"C","T":1/3}
         ]
    }
}
pydirectinput.PAUSE=0
Cancelled = False

def on_Esc_pressed():
    global Cancelled
    Cancelled = True
keyboard.add_hotkey('esc',on_Esc_pressed)

def ActualClick():
    pydirectinput.mouseDown()
    time.sleep(0.1)
    pydirectinput.mouseUp()

def DOCLICK():
    thread1 = threading.Thread(target=ActualClick)
    thread1.start()

print("Ready")
time.sleep(1)
print("Set")
time.sleep(1)

if Cancelled == True:
    exit()
pydirectinput.click() #enter tab
    
SongDict = AllSongs[SongToPlay]
Tempo = SongDict["Tempo"]
NotesArray = SongDict["NotesArray"]

BaseSecondWait=60/Tempo
for notetable in NotesArray:
    Note = notetable["Note"]
    NotePosTable = NotePositions[Note]
    NotePosX = NotePosTable[0]
    NotePosY = NotePosTable[1]

    #wait before code
    FinalSecondToWait = BaseSecondWait*notetable["T"]
    print('---')
    print(FinalSecondToWait)
    start_time = time.perf_counter()
    time.sleep(FinalSecondToWait)
    

    if Cancelled == True:
        break
    #Click
    pyautogui.moveTo(NotePosX,NotePosY)
    DOCLICK()
    elapsed_time = time.perf_counter() - start_time
    print(f"Elapsed time: {elapsed_time:.6f} seconds")
    

